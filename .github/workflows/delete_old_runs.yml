name: ğŸ§¹ æ‰¹é‡æ¸…ç† GitHub Actions å†å²è¿è¡Œ

on:
  workflow_dispatch: # æ‰‹åŠ¨è§¦å‘
 # schedule:
   # - cron: "0 2 * * *"  # æ¯å¤©å‡Œæ™¨2ç‚¹è‡ªåŠ¨æ¸…ç†

permissions:
  actions: write
  contents: read

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ”‘ è®¾ç½® GITHUB_TOKEN
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: echo "Using GITHUB_TOKEN"

      - name: ğŸ§¹ åˆ é™¤æ—§çš„ Workflow Runs
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const runs = await github.rest.actions.listWorkflowRunsForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              per_page: 100
            });

            let deleted = 0;
            for (const run of runs.data.workflow_runs) {
              if (['completed', 'failure', 'cancelled'].includes(run.status)) {
                try {
                  await github.rest.actions.deleteWorkflowRun({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    run_id: run.id
                  });
                  console.log(`âœ… Deleted run ${run.id} (${run.name})`);
                  deleted++;
                } catch (err) {
                  console.log(`âŒ Failed to delete run ${run.id}: ${err.message}`);
                }
              }
            }

            console.log(`\nğŸ§¾ æ€»è®¡åˆ é™¤ ${deleted} ä¸ªè¿è¡Œè®°å½•`);
