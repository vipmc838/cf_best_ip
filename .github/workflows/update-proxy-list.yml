name: ğŸ”„ æ›´æ–°ä»£ç†åˆ—è¡¨

on:
  schedule:
    - cron: '0 23 * * *'  # åŒ—äº¬æ—¶é—´æ—©ä¸Š7ç‚¹
    - cron: '0 11 * * *'  # åŒ—äº¬æ—¶é—´æ™šä¸Š7ç‚¹
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-proxies:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        ref: main
      
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.9'
        
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4
        
    - name: æŠ“å–ä»£ç†åˆ—è¡¨
      run: |
        echo "å¼€å§‹æŠ“å–ä»£ç†åˆ—è¡¨..."
        python s5/generate_proxy_list.py
        echo "æŠ“å–å®Œæˆï¼Œæ£€æŸ¥æ–‡ä»¶..."
        if [ -f s5/proxy.txt ]; then
          echo "s5/proxy.txt æ–‡ä»¶å·²ç”Ÿæˆ"
          echo "æ–‡ä»¶å†…å®¹é¢„è§ˆï¼š"
          head -10 s5/proxy.txt
        else
          echo "s5/proxy.txt æ–‡ä»¶æœªç”Ÿæˆ"
          exit 1
        fi
        
    - name: æäº¤æ›´æ–°
      run: |
        git config --global user.email "action@github.com"
        git config --global user.name "GitHub Action"
        git add s5/proxy.txt
        if git diff --staged --quiet; then
          echo "æ²¡æœ‰æ›´æ”¹éœ€è¦æäº¤"
        else
          git commit -m "æ›´æ–°ä»£ç†åˆ—è¡¨ $(date +'%Y-%m-%d %H:%M:%S')"
          git push
        fi
